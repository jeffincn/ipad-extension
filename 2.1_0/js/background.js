var background = function(){
    this.init();
};

$(document).ready(function() {
    new background;
});
var _$=['current version: ','version','undefined','options_update_run','true','htm/options.html','options_update_run','true','htm/options.html','options_update_run','true',"htm/options.html",'version','messages','(msg_id text, msg_title text, msg_desc text, msg_url text, msg_type text, msg_picurl text, msg_date text, msg_buyurl text, msg_fav int, msg_top int)','msg_fav=0 and msg_id like "99___"','noti_desktop','noti_desktop','on','noti_sound','noti_sound','on','last_msg_id','last_msg_id','0','last_msg_date','last_msg_date','','unchecked_msg','unchecked_msg','0','item_location','item_location','cn;global','noti_cat_18301','noti_cat_18301','on','message_limit','message_limit','100','msg_id in (select msg_id from messages where msg_fav=0 order by msg_date desc limit ','message_limit',',100000)','unchecked_msg','','last_msg_id','looping','last_msg_date','?f=browser&mod=get_post_twenty','last_msg_id','last_msg_date','?f=browser&mod=get_post_twenty&lasttime=',",","cn;global",'msg_id in (select msg_id from messages where msg_fav=0 order by msg_date desc limit ','message_limit',',100000)','noti_cat_99999','on','3535',"cn",'8296',"global",'item_location','noti_cat_',"off",'last_msg_id','last_msg_date','item_time1','item_time2','noti_time','on','noti_time','on','noti_desktop','on','/','.','notification.html?msg_id=','','../img/smzdm128.png',"desktop_time",'noti_sound','on',"../img/notify.mp3"];background["prototype"]={init:function(){this["init_background"]();this["init_push"]()},init_background:function(){var details=chrome["app"]["getDetails"]();var current_version=details["version"];console["log"](_$[0]+current_version);var prev_version=localStorage[_$[1]];if(current_version!=prev_version){if(typeof prev_version==_$[2]){localStorage[_$[3]]=_$[4];kerData["goto"](_$[5])}else{if(current_version["length"]<=3){localStorage[_$[6]]=_$[7];kerData["goto"](_$[8])}else{if(current_version["substr"](0,3)!=prev_version["substr"](0,3)){localStorage[_$[9]]=_$[10];kerData["goto"](_$[11])}}};localStorage[_$[12]]=current_version};database["creat"]({table:_$[13],field:_$[14]});database["dele"]({where:_$[15]});window["message_config"]={message_all:0,message_all_unread:0,message_fav:0,message_fav_unread:0};kerData["sync_message_number"](function(msg_num){})},init_push:function(){localStorage["getItem"](_$[16])==null&&localStorage["setItem"](_$[17],_$[18]);localStorage["getItem"](_$[19])==null&&localStorage["setItem"](_$[20],_$[21]);localStorage["getItem"](_$[22])==null&&localStorage["setItem"](_$[23],_$[24]);localStorage["getItem"](_$[25])==null&&localStorage["setItem"](_$[26],_$[27]);localStorage["getItem"](_$[28])==null&&localStorage["setItem"](_$[29],_$[30]);localStorage["getItem"](_$[31])==null&&localStorage["setItem"](_$[32],_$[33]);localStorage["getItem"](_$[34])==null&&localStorage["setItem"](_$[35],_$[36]);localStorage["getItem"](_$[37])==null&&localStorage["setItem"](_$[38],_$[39]);database["dele"]({where:_$[40]+localStorage["getItem"](_$[41])+_$[42]});chrome["browserAction"]["onClicked"]["addListener"](function(tab){localStorage["setItem"](_$[43],0);chrome["browserAction"]["setBadgeText"]({text:_$[44]});kerData["goto"](config["site"],function(tab){smzdmTabId=tab["id"]})});var notify=new Notify();notify["getPermission"]();this["start_push"]()},start_push:function(){var last_msg_id=parseInt(localStorage["getItem"](_$[45])),self=this;console["log"](_$[46]);if(last_msg_id<=0)self["get_items"]();else self["get_ids"]();setTimeout(self["start_push"]["bind"](self),45000)},get_ids:function(){var last_msg_date=localStorage["getItem"](_$[47]),self=this;$["getJSON"](config["getUrlc"]+_$[48],function(d){if(d["error"]>0)return false;var data=d["data"],datalength=data["length"];$["each"](data,function(idx,msg){if(msg["msg_date"]>last_msg_date){self["get_items"]();return false}})})},get_items:function(callback){var last_msg_id=parseInt(localStorage["getItem"](_$[49])),last_msg_date=localStorage["getItem"](_$[50]),ins=[],self=this;$["getJSON"](config["getUrlc"]+_$[51]+((last_msg_date<=0)?1:last_msg_date),function(d){if(d["error"]>0)return false;var data=d["data"],datalength=data["length"];$["each"](data,function(idx,msg){var is_selected=false,msg_id=parseInt(msg["msg_id"]),msg_date=msg["msg_date"];if((msg_id!=last_msg_id)&&(msg_date>last_msg_date)){var categories=msg["msg_categories"]["split"](_$[52])["sort"](function a(a,b){return a-b}),all_categories=[],default_categories=[],item_locations=[],item_location=_$[53],location_categories=location_cls;last_msg_id=msg_id;last_msg_date=msg_date;database["insert"]({data:{msg_id:msg["msg_id"],msg_title:msg["msg_title"],msg_desc:msg["msg_desc"],msg_url:msg["msg_url"],msg_categories:msg["msg_categories"],msg_picurl:msg["msg_picurl"],msg_date:msg["msg_date"],msg_buyurl:msg["msg_buyurl"],msg_fav:0,msg_top:0}},function(tx,rs){database["dele"]({where:_$[54]+localStorage["getItem"](_$[55])+_$[56]});$["each"](all_cls,function(i,da){all_categories[i]=da[0]});$["each"](default_cls,function(i,da){default_categories[i]=da[0]});var item_categories=kerData["array_intersect"](categories,all_categories["sort"](function b(a,b){return a-b}));var item_defaults=kerData["array_intersect"](categories,default_categories["sort"](function b(a,b){return a-b}));var item_locations=kerData["array_intersect"](categories,location_categories["sort"](function b(a,b){return a-b}));if(localStorage["getItem"](_$[57])==_$[58])is_selected=true;if(item_defaults["length"]>0){is_selected=true};if(item_locations["length"]>0){if(item_locations[0]==_$[59])item_location=_$[60];if(item_locations[0]==_$[61])item_location=_$[62]};if(localStorage["getItem"](_$[63])["indexOf"](item_location)<0)is_selected=false;if(item_categories["length"]>0){if((localStorage["getItem"](_$[64]+item_categories[0])==_$[65])){is_selected=false}};if(is_selected)ins["push"](msg);if(idx==datalength-1)self["pup"](ins);kerData["sync_message_number"]()})}});localStorage["setItem"](_$[66],last_msg_id);localStorage["setItem"](_$[67],last_msg_date)})},pup:function(ins){var inslength=ins["length"],noti_pool=[];$["each"](ins,function(idx,msg){var time=new Date()["getHours"](),ontime=true,time1=localStorage["getItem"](_$[68]),time2=localStorage["getItem"](_$[69]);time1=time1!=null?parseInt(time1):0;time2=time2!=null?parseInt(time2):0;if((localStorage["getItem"](_$[70])==_$[71])&&(time1>time2)){if(time>time1||time<time2)ontime=false}else if((localStorage["getItem"](_$[72])==_$[73])&&(time1<time2)){if(time>time1&&time<time2)ontime=false};if(ontime==true&&localStorage["getItem"](_$[74])==_$[75]&&(idx==inslength-1||idx==inslength-2||idx==inslength-3)){var obj=window["webkitNotifications"],nav=((window["navigator"]["userAgent"])["split"](_$[76]))[3]["split"](_$[77]);if(nav[2]<1460){noti_pool[idx]=obj["createHTMLNotification"](_$[78]+msg["msg_id"])}else{noti_pool[idx]=obj["createNotification"]((msg["msg_picurl"]!=_$[79]?msg["msg_picurl"]:_$[80]),msg["msg_title"],msg["msg_desc"]["substring"](0,120));noti_pool[idx]["onclick"]=function(){kerData["set_message_read"](msg["msg_id"]);kerData["goto"](msg["msg_url"])}};noti_pool[idx]["ondisplay"]=function(event){setTimeout(function(){event["currentTarget"]["cancel"]()},localStorage["getItem"](_$[81])*1000)};noti_pool[idx]["show"]();if(localStorage["getItem"](_$[82])==_$[83]){new Audio(_$[84])["play"]()}}})}};